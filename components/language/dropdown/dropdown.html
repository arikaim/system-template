{% set selected = selected|default(getCurrentLanguage()) %}

{% if selected is string %}
    {% set selected = createModel('Language').findByColumn(selected,'code') %}
{% endif %}

{% set active_only = show_title|default(true) %}
{% set show_title = show_title|default(false) %}
{% set show_native_title = show_title|default(false) %}
{% set id = id|default('language_menu') %}
{% set class = class|default('icon inline top right pointing') %}

{% set language = createModel('Language') %}
{% if active_only == true %} 
    {% set items = language.where('status',1).orderBy('position').get() %}
{% else %}
    {% set items = language.orderBy('position').get() %}
{% endif %}

<div class="ui dropdown {{ class }}" id="{{ id }}">      
    {% if name is not empty %}           
        <div class="default text">{{ label.default }}</div>
        <input name="{{ name }}" type="hidden" value="{{ selected.code }}">
    {% else %}  
        <i class="flag {{ selected.country_code }}" title="{{ selected.title }}"></i>
    {% endif %}
    {% if show_title == true %}      
        {{ selected.title }}
    {% endif %}
    <div class="ui mini vertical menu">  
    {% if title != "" %} 
        <div class="ui header">{{ title }}</div>
    {% endif %}
    {% for item in items %}
        <div title="{{ item.title }}" class="item {{ item.code|ifthen(selected.code,'active') }}" data-value="{{ item.code }}">            
            <i class="flag {{ item.country_code|lower }}"></i>
            {% set bold_style = (item.code == selected.code) ?  'font-bold' : '' %}             
            {% if show_native_title == true %}
                <span class="{{ bold_style }}">{{ item.native_title }}</span>
            {% else %}
                <span class="{{ bold_style }}">{{ item.title }}</span>
            {% endif %}
        </div>      
    {% endfor %}
    </div>
</div>